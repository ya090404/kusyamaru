<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>くしゃまるくんアプリ</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      overflow: hidden;
      touch-action: manipulation;
    }
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #character, #overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    #overlay {
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="container">
    <img id="character" src="punch_right.PNG" />
    <img id="overlay" />
  </div>

  <audio id="punchSound" src="punch.mp3" preload="auto"></audio>
  <audio id="explosionSound" src="explosion.mp3" preload="auto"></audio>
  <audio id="clearSound" src="clear.mp3" preload="auto"></audio>

  <script>
    const character = document.getElementById('character');
    const overlay = document.getElementById('overlay');
    const punchSound = document.getElementById('punchSound');
    const explosionSound = document.getElementById('explosionSound');
    const clearSound = document.getElementById('clearSound');

    const punchImages = ['punch_right.PNG', 'punch_left.PNG'];
    const cracks = ['crack_1.PNG', 'crack_2.PNG', 'crack_3.PNG'];

    let punchCount = 0;
    let punchToggle = 0;
    let crackPhase = 0;
    let showingCrack = false;

    document.getElementById('container').addEventListener('click', () => {
      if (punchCount >= 34) return;

      // 爆発：33発目
      if (punchCount === 33) {
        overlay.src = 'explosion.PNG';
        character.style.display = 'none';
        explosionSound.play();
        punchCount++;
        return;
      }

      // すっきり：34発目
      if (punchCount === 34) {
        overlay.src = 'clear.PNG';
        clearSound.play();
        punchCount++;
        return;
      }

      // ヒビ演出（10回, 20回, 30回目）だけカットイン → 次パンチで通常戻す
      if ((punchCount > 0) && (punchCount % 10 === 0) && crackPhase < cracks.length) {
        overlay.src = cracks[crackPhase];
        crackPhase++;
        punchSound.currentTime = 0;
        punchSound.play();
        showingCrack = true;
        punchCount++;
        return;
      }

      // 通常パンチ表示
      character.src = punchImages[punchToggle];
      punchToggle = 1 - punchToggle;

      overlay.src = ''; // ヒビ画像が出ていたら消す
      punchSound.currentTime = 0;
      punchSound.play();

      punchCount++;
    });
  </script>
</body>
</html>